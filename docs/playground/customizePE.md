# 个性化 WinPE

FirPE 为用户提供了个性化接口，您可通过个性化接口来满足自己的需要。

::: tip 提示

- U 盘个性化接口位于 U 盘的`\FirPE`目录，如无此目录可自行创建。
- 本地安装的个性化接口位于`C:\FirPE`目录。
- ISO 镜像个性化接口随镜像生成，其文件名为“FirPE-VX.X.X-数据区文件.zip”，通常情况下需要解压至 U 盘，如不依靠 U 盘则可以将其解压至 ISO 文件内部。
- 删除本目录不影响 WinPE 正常运行。

:::

::: warning 注意
`FirPE`目录仅在根目录下有效，存放在二级目录（如`\我的文件\FirPE`）将无效。
:::

## 个性化壁纸

将壁纸图片转换为 jpg 格式，命名为`wp.jpg`，放置于`\FirPE\`目录下即可。

- 同时支持暗色主题壁纸，将暗色壁纸重命名为"dark.jpg"，放置于`\FirPE\`目录（请注意文件后缀）。

## 个性化系统

FirPE 提供了丰富的个性化选项，可在`\FirPE\FirPE.ini`中进行配置，包括但不限于界面个性化、系统功能个性化。

- 以下为个性化选项配置示例（实际功能以原文件为准，此处只为参考）

  ```ini
  ; 0表示关闭，1表示开启

  [硬件和声音]
  开启小键盘=0

  [程序]
  自动理顺磁盘=0
  显示桌面硬件信息=0

  [外观和个性化]
  任务栏不合并=0
  显示文件复选框=0
  隐藏文件扩展名=0
  ```

## 个性化程序

将程序放置于 `\FirPE\Tools` 目录内，进入 WinPE 后会自动创建桌面快捷方式、开始菜单快捷方式，无需编写配置文件或菜单文件。

支持以下程序形式：

- 文件夹形式（绿色软件）
- 单文件形式（单文件打包程序）
- 压缩包形式（7z、zip、rar、wim 格式）

## 自动运行程序

将需要开启自动运行的程序放置于 Startup 内，进入 WinPE 后将自动运行里面的程序，支持自动运行程序类型：`*.exe`、`*.lnk`、`*.reg`、`*.cmd`、`*.bat`。其中`*.reg`将自动导入，其他程序类型将复制到`%ProgramFiles%`后运行，避免移除 U 盘带来的麻烦。

### 自定义桌面文件

新建“Desktop”目录（`U盘:\FirPE\Desktop`），该目录存放桌面文件，可将需要放入桌面的程序放入此目录。

## 增加系统驱动

::: tip 提示

- 一般情况下，WinPE 集成了大量硬盘驱动、网卡驱动，但依旧无法满足市面上的电脑，有需要可增加驱动包。
- 驱动包需要为压缩包支持格式，通常设备官网下载的 exe 安装包不被支持（WinPE 中无法正常加载），需要自行提取并打包为压缩包。

:::

将驱动打包为压缩包（支持格式：wim、7z、zip、rar、cab）并放置于 `\FirPE\Drivers` 文件夹内，也可直接将驱动目录放置于此目录内。

## 补充/替换 WinPE 文件

### 补充/替换`Windows`文件夹内的文件

::: tip 提示
由于 WinPE 是一个极度精简的系统，缺失很多依赖文件，无法支持大量软件的运行，因此有需要可以补充/替换`dll`等系统文件。
:::

将系统文件放置于`\FirPE\Windows`，WinPE 启动后此目录内的所有文件将被覆盖复制到`X:\Windows`内，即补充 WinPE 系统文件。

- 如需要补充/替换`System32`文件夹下的 dll 文件，可新建目录`\FirPE\Windows\System32`，并将需要补充/替换的 dll 文件复制到此目录
- 如需要补充/替换`SysWOW64`文件夹下的 dll 文件，可新建目录`\FirPE\Windows\SysWOW64`，并将需要补充/替换的 dll 文件复制到此目录

### 补充/替换`Program Files`文件夹内的文件

新建“Program Files”文件夹（`U盘:\FirPE\Program Files`），在 WinPE 启动后将自动覆盖复制目录内的文件（夹）到 `X:\Program Files` 内。

### 补充/替换`Program Files (x86)`文件夹内的文件

新建“Program Files”文件夹（`U盘:\FirPE\Program Files (x86)`），在 WinPE 启动后将自动覆盖复制目录内的文件（夹）到 `X:\Program Files (x86)` 内。

## 用户自定义生命周期钩子脚本

用于存放用户编写的自定义生命周期钩子脚本，在当前目录内新建“Hooks”文件夹（`U盘:\FirPE\Hooks`），这些脚本将在 WindowsPE 启动和运行期间的不同生命周期阶段被调用执行。

### 目录结构

- **\Hooks**
- **beforeBoot.cmd**
  存放在系统启动前执行的自定义脚本。
- **afterBoot.cmd**
  包含系统启动后执行的自定义脚本。
- **beforeDesktop.cmd**
  包含进入桌面前执行的自定义脚本。
- **afterDesktop.cmd**
  存放进入桌面后执行的自定义脚本。
- **onBootFinished.cmd**
  包含系统启动完成后执行的自定义脚本。
- **beforeExit.cmd**
  存放在 WindowsPE 退出前执行的自定义脚本。

### 使用说明

1. 根据上述的目录结构，创建对应的脚本文件。
2. 根据需要编写自定义脚本到对应的生命周期文件中。
3. 脚本将在相应的生命周期阶段被调用执行。

### 内置变量

- `%USBDrive%`: 表示 U 盘中的本目录（即`U盘:\FirPE`）
- `%SystemRoot%`: `X:\Windows`
- `%ProgramFiles%`: `X:\Program Files`
- `%ProgramFiles(x86)%`: `X:\Program Files (x86)`

### 使用示例

新建文件：`U盘:\FirPE\Hooks\afterDesktop.cmd`（进入桌面后执行的脚本），右键记事本打开编辑内容如下：

```cmd
start "" "%ProgramFiles(x86)%\备份还原\EasyRC\EasyRCV3.exe"
```

以上示例脚本实现了进入 WinPE 后自动运行 EasyRC 程序。

### 注意事项

- 所有自定义脚本应遵循指定的命名约定和脚本编写规范。
- 脚本应该只包含必要的逻辑和操作，并且在相关生命周期阶段按需执行。
- 使用适当的错误处理和日志记录机制，确保脚本执行的稳定性和可靠性。
- 在添加自定义脚本之前，请确保了解其对系统运行的潜在影响。
